#! /home/andreas/src/c/stubforth/stubforth

" /usr/lib/libpq.so.5" dlopen constant libpq

libpq " PQconnectdb"	1	cbind pqconnectdb
libpq " PQerrorMessage" 1	cbind pqerrormessage
libpq " PQexec"			2	cbind pqexec
libpq " PQstatus"		1	cbind pqstatus
libpq " PQgetvalue"		3	cbind pqgetvalue

variable pgconn

: ?pqstatus
	pgconn @ pqstatus
	if
		pgconn @ pqerrormessage throw
	then
;

: connect
	," " pqconnectdb pgconn ! ?pqstatus ;

: version
	," select version();" pgconn @ pqexec
	?pqstatus
	0 0 2 pick pqgetvalue type lf
	?pqstatus
;

connect
version
0 redirect !

